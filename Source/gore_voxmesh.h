#ifndef GORE_VOXMESH_H_INCLUDED
#define GORE_VOXMESH_H_INCLUDED

#include "gore_asset.h"
#include "gore_voxshared.h"
#include "gore_render_state.h"

enum voxel_normal_type_index{
	VoxelNormalIndex_Up,
	VoxelNormalIndex_Down,
	VoxelNormalIndex_Left,
	VoxelNormalIndex_Right,
	VoxelNormalIndex_Front,
	VoxelNormalIndex_Back,

	VoxelNormalIndex_Count,
};

enum voxel_texture_vert_type{
	VoxelTextureVertType_UpLeft,
	VoxelTextureVertType_UpRight,
	VoxelTextureVertType_DownRight,
	VoxelTextureVertType_DownLeft,
};

struct voxworld_table_entry {
	voxworld_table_entry* NextInHash;

	voxworld_table_entry* NextBro;
	voxworld_table_entry* PrevBro;

	u32 Key;

	voxel_chunk_info* ValueChunk;
};

static float VoxelSmoothRandoms[] = {
	0.57531, 0.23125, 0.49795, 0.55092, 0.11237, -0.70323, -0.38470, 0.05705,
	-0.75583, -0.64911, 0.64457, -0.13959, -0.01124, 0.13025, 0.47642, 0.17669,
	-0.88462, 0.78858, -0.04387, 0.51639, 0.49248, -0.63442, -0.86889, 0.25548,
	-0.26505, 0.01581, 0.83507, -0.64808, 0.32070, -0.56634, -0.83306, -0.54079,
	-0.63150, -0.62856, -0.37989, 0.37456, -0.63752, 0.49369, -0.70528, 0.36158,
	0.76077, 0.24458, 0.65641, -0.70856, 0.91857, -0.93835, 0.33667, -0.16470,
	-0.20468, 0.23600, 0.93748, 0.44627, -0.89715, -0.99288, -0.40557, 0.01044,
	-0.69125, 0.84832, 0.42352, -0.17493, 0.72060, -0.26543, 0.50505, 0.89576,
	-0.70661, -0.54312, 0.79769, 0.43739, 0.71358, 0.38654, 0.74712, -0.46548,
	0.20087, -0.03638, -0.52827, -0.07489, -0.37432, -0.26445, 0.13549, 0.48151,
	0.91588, -0.49351, -0.94773, 0.33208, -0.02370, -0.64732, -0.73731, 0.35903,
	0.16853, -0.54268, 0.50051, -0.83649, -0.59929, 0.01937, -0.79794, 0.40725,
	-0.07143, -0.19497, 0.31977, -0.31876, -0.84047, 0.04637, -0.68682, -0.77134,
	0.13599, 0.23467, -0.88556, -0.04484, -0.25812, -0.94974, 0.73403, -0.19634,
	-0.59208, 0.49453, -0.85208, -0.02646, 0.93949, 0.69600, -0.31856, -0.35776,
	0.74466, -0.91138, -0.07206, -0.63948, -0.61389, 0.18700, 0.01275, 0.69177,
	-0.32868, 0.51707, 0.67645, 0.20666, -0.08636, 0.17994, 0.25615, 0.76775,
	0.07923, -0.19795, -0.44333, -0.49470, 0.28185, 0.26533, -0.80951, -0.54490,
	-0.84059, 0.35929, 0.37799, -0.55012, -0.71545, -0.91331, 0.40660, -0.67587,
	-0.92628, -0.64711, 0.72174, -0.12161, 0.14243, 0.17321, -0.72511, -0.79824,
	0.94171, -0.48439, -0.16430, -0.00603, 0.15806, -0.76016, -0.48288, 0.57069,
	0.61992, 0.14465, 0.16103, -0.79078, -0.20231, 0.41862, 0.65153, 0.90319,
	0.59205, 0.13461, 0.80017, 0.93056, -0.48711, -0.91363, -0.21845, -0.29440,
	0.12853, -0.38453, -0.98419, 0.39169, -0.95929, -0.63216, 0.45902, -0.60857,
	-0.89618, -0.78888, -0.78267, 0.84233, 0.63774, 0.61154, 0.05185, -0.57616,
	-0.89107, -0.82470, 0.35625, 0.83568, -0.54600, -0.96028, -0.99622, 0.18059,
	0.86140, 0.46982, -0.94983, -0.32617, 0.14243, 0.99099, -0.15832, 0.67989,
	-0.01334, -0.01174, -0.53112, 0.69136, 0.51095, -0.62249, 0.17791, 0.60633,
	0.90358, 0.41709, 0.56894, 0.91872, 0.59031, -0.55694, -0.24076, 0.72300,
	-0.48815, 0.74666, -0.66598, -0.33672, 0.47897, -0.95802, 0.03832, 0.16717,
	0.11911, -0.99066, 0.94003, -0.32468, -0.83380, -0.36519, 0.45277, -0.58143,
	-0.07573, -0.19688, 0.73772, -0.48934, -0.45376, -0.11373, 0.62971, 0.65725,
	-0.44296, -0.68030, 0.84644, 0.42005, -0.91814, -0.34729, 0.86425, 0.68225,
	0.99023, -0.50418, -0.15425, -0.62781, 0.56744, 0.27849, 0.38166, 0.98456,
	-0.68172, 0.24254, 0.64846, 0.18113, 0.87226, 0.50871, -0.83739, 0.77648,
	-0.97801, -0.30243, 0.35806, 0.75886, -0.77463, -0.45148, -0.21328, -0.32044,
	-0.43604, -0.72135, -0.83314, 0.32053, -0.52097, -0.22804, 0.35441, -0.82587,
	0.33697, 0.98900, -0.28962, -0.01706, -0.20589, 0.74934, -0.21029, -0.57010,
	0.98731, 0.06850, 0.04173, 0.01750, 0.97289, -0.23674, 0.09748, 0.64364,
	0.86240, 0.16388, 0.98505, 0.31531, 0.68599, 0.37454, 0.38339, 0.81679,
	-1.00000, 0.59320, 0.45417, -0.80868, 0.47023, -0.62843, 0.30111, -0.01671,
	-0.16529, 0.27681, 0.69990, -0.84011, 0.14372, -0.42448, -0.89536, -0.62868,
	-0.68575, 0.13166, -0.21414, -0.04518, -0.71239, 0.51493, 0.45383, 0.99030,
	-0.97374, 0.61493, 0.01793, 0.20984, -0.79621, -0.22783, -0.72622, -0.31603,
	0.96490, 0.37698, -0.21168, -0.15748, -0.82276, 0.26330, 0.41519, 0.44356,
	-0.14621, -0.46505, 0.72850, -0.23762, 0.74027, 0.36963, 0.06112, -0.06385,
	0.89880, 0.99649, 0.26644, -0.37941, -0.71585, 0.01582, 0.94615, -0.58943,
	0.16810, 0.87027, 0.40801, -0.65661, 0.57595, -0.57049, -0.17171, -0.94600,
	-0.81449, 0.72860, -0.55265, 0.50802, 0.40233, 0.85688, -0.38130, 0.89025,
	-0.60200, -0.60802, -0.39201, -0.00216, 0.32344, 0.44535, 0.97317, 0.66807,
	-0.48806, -0.79933, 0.63910, 0.78213, -0.89185, 0.33823, 0.78078, 0.71144,
	0.93119, -0.54043, 0.73974, -0.91475, -0.41532, -0.62841, -0.79480, -0.68957,
	-0.69653, 0.40571, 0.49301, 0.93864, 0.57628, -0.37150, 0.71061, 0.08185,
	-0.71687, 0.46178, -0.90794, 0.94242, -0.90621, 0.70753, -0.72767, -0.81154,
	-0.64456, 0.31930, 0.97228, -0.79093, -0.05018, 0.02461, -0.02310, 0.75980,
	-0.72903, -0.86078, 0.09426, 0.95584, -0.52024, 0.77749, 0.55174, -0.17611,
	-0.81154, 0.78952, 0.42981, 0.26427, -0.97308, 0.96011, 0.71636, 0.49863,
	0.43959, 0.56540, -0.03104, 0.04502, 0.38337, -0.55831, 0.68761, 0.59806,
	-0.76452, 0.96615, -0.36849, -0.88238, -0.08265, 0.04309, -0.62509, 0.48630,
	0.76765, 0.17018, 0.61107, -0.99093, -0.55954, 0.53477, 0.66625, 0.72943,
	0.65346, -0.91402, 0.84478, -0.30816, 0.68978, -0.50016, 0.66872, -0.08295,
	-0.13357, -0.90839, 0.74312, 0.81503, -0.89746, -0.06810, 0.11023, -0.80386,
	-0.35893, -0.74669, 0.23434, 0.15445, -0.89834, 0.38578, 0.58694, 0.91007,
	-0.61763, 0.43756, -0.92380, 0.53164, 0.08723, -0.98905, -0.19287, -0.87565,
	0.05418, -0.56949, 0.22248, 0.89794, 0.54922, -0.25845, 0.67901, 0.05685,
	0.32972, -0.19455, 0.56726, 0.59098, 0.20728, -0.15320, -0.33299, 0.16729,
	-0.63234, -0.77360, -0.76471, -0.82176, -0.51128, 0.58171, -0.20535, 0.17655,
	0.40602, 0.89749, 0.36398, 0.59005, 0.80240, -0.34256, -0.61187, -0.37353,
	0.83051, -0.64134, -0.47709, 0.31641, -0.11749, -0.51190, 0.81705, -0.50540,
	0.92944, 0.98978, -0.34561, 0.75384, -0.36850, -0.75645, -0.22878, 0.26112,
	-0.11013, 0.31137, 0.10949, 0.07292, 0.67623, -0.12569, -0.74324, 0.86926,
	0.52398, -0.35028, -0.58388, 0.76779, -0.57725, -0.79349, -0.01330, 0.99476,
	0.06434, -0.49674, -0.81104, 0.66416, 0.98714, 0.85159, 0.30516, -0.08807,
	0.50879, 0.59440, -0.80050, 0.51077, -0.52800, -0.73129, 0.74619, -0.53774,
	-0.73062, 0.22858, -0.74631, 0.05364, 0.80115, 0.28429, -0.87087, 0.12510,
	0.80757, 0.74031, 0.51732, 0.27257, -0.44967, 0.11741, -0.29810, -0.34820,
	0.03052, 0.84454, 0.02835, -0.58346, -0.24299, 0.36453, -0.70138, 0.58795,
	0.11742, -0.22451, -0.72482, 0.14936, -0.13924, 0.96686, 0.10839, 0.57780,
	-0.07451, 0.50461, -0.64971, -0.58575, -0.63014, -0.91727, -0.97433, -0.27009,
	0.48566, 0.93969, 0.79216, -0.19844, 0.31306, -0.01105, 0.86596, 0.45049,
	0.99716, 0.35590, 0.35073, 0.55643, -0.61643, -0.15419, -0.60685, -0.86574,
	-0.06308, -0.96465, -0.68148, -0.73880, -0.10292, -0.93438, 0.12735, 0.41080,
	-0.79388, -0.63083, -0.96924, -0.98146, -0.22442, -0.01838, -0.26468, -0.78208,
	-0.22786, 0.37448, -0.42547, -0.23367, -0.38511, -0.18109, 0.77999, -0.92635,
	-0.63094, 0.68781, -0.15012, 0.88476, -0.00870, 0.33361, 0.12611, -0.70483,
	0.42159, 0.82765, -0.93829, 0.95245, -0.95854, -0.30414, 0.86433, 0.98171,
	0.13024, 0.36646, -0.68969, 0.64868, 0.52433, -0.51093, 0.39355, -0.19336,
	-0.50265, 0.98325, -0.89250, 0.20553, 0.68870, -0.60361, 0.60530, -0.53879,
	-0.63640, -0.15308, 0.23222, -0.94317, -0.18685, -0.86271, 0.51096, -0.69317,
	-0.11071, 0.59747, 0.78143, -0.50245, 0.58202, 0.25637, 0.38950, -0.97931,
	0.09839, 0.72592, 0.62820, 0.94877, 0.72048, 0.96235, -0.40114, -0.67614,
	0.31361, -0.45549, -0.85138, 0.70439, -0.96486, -0.93812, -0.88939, -0.21048,
	-0.74037, 0.02665, 0.44062, 0.22563, 0.17126, 0.90248, 0.42166, -0.01866,
	0.48967, 0.00229, 0.71503, 0.52727, 0.37867, 0.48091, 0.18120, -0.55347,
	0.14825, -0.30943, 0.84005, -0.44501, -0.10436, -0.68011, 0.10368, -0.80198,
	-0.30486, -0.28087, -0.42225, -0.10202, 0.66040, 0.89379, 0.56493, 0.12612,
	-0.48455, 0.07545, 0.04840, 0.62375, -0.45159, 0.64293, -0.69885, -0.11290,
	-0.36391, -0.94953, 0.08057, -0.56361, 0.33608, 0.38616, -0.33291, 0.83779,
	0.40555, -0.45241, 0.84120, 0.56635, -0.52872, -0.42630, 0.43054, 0.10198,
	-0.42018, 0.62173, -0.27218, -0.22679, -0.49113, -0.95465, 0.56793, 0.02796,
	0.25272, 0.24108, 0.94179, 0.06740, 0.27313, -0.96643, -0.05371, -0.90862,
	-0.89437, 0.98539, 0.92274, 0.38457, 0.02273, 0.84222, 0.92392, 0.95116,
	0.66450, -0.04773, -0.64151, 0.03816, -0.97119, -0.89718, -0.67989, -0.49929,
	0.72823, -0.91897, -0.53248, -0.05493, -0.64801, -0.17446, -0.93907, -0.82891,
	0.99695, -0.89582, 0.43847, 0.31351, 0.99359, -0.39823, 0.15200, -0.93006,
	-0.82698, 0.54422, 0.89949, -0.63804, -0.27731, 0.29950, 0.25119, 0.77797,
	0.72172, 0.62844, 0.36704, -0.04966, 0.46828, -0.63079, 0.61123, -0.34611,
	-0.44469, 0.78275, 0.60810, 0.73206, 0.73684, -0.07860, 0.01671, 0.91935,
	-0.66666, -0.67958, -0.55286, 0.00632, -0.71696, 0.93252, 0.40343, 0.08821,
	-0.81046, -0.91117, -0.53757, -0.14288, -0.32467, -0.13726, -0.27786, 0.07151,
	-0.08131, 0.26905, 0.82135, 0.77855, 0.26015, -0.01263, -0.82202, 0.66241,
	0.14900, -0.36326, -0.19156, 0.40397, 0.24190, -0.60621, 0.43799, -0.85962,
	0.91606, -0.01916, -0.41590, 0.62889, 0.19153, -0.28836, 0.12949, -0.39676,
	0.38613, -0.13933, 0.28997, 0.69005, 0.52095, 0.38617, 0.47124, 0.05824,
	0.40700, -0.38958, -0.46270, 0.65911, 0.22427, 0.38284, -0.71258, -0.92345,
	0.99013, 0.68086, -0.08854, 0.55098, -0.23242, -0.49931, 0.95054, 0.23656,
	-0.03955, -0.78984, 0.00586, 0.66080, 0.17066, 0.17179, -0.86933, 0.27239,
	-0.09146, 0.63054, 0.87310, -0.80327, -0.35467, 0.10725, -0.29089, 0.78675,
	-0.23776, 0.71256, -0.09631, 0.36852, 0.38357, -0.34639, 0.33049, 0.51903,
	-0.66168, -0.79219, -0.92874, 0.85620, -0.56702, 0.93481, -0.64325, -0.29460,
	0.66778, 0.69160, 0.53703, 0.47645, -0.50860, 0.72558, 0.30003, -0.03797,
	-0.16103, 0.79817, 0.02698, 0.55773, -0.44209, -0.57530, -0.48862, -0.99356,
	0.54612, -0.10961, 0.87447, -0.28958, -0.95597, -0.24775, 0.51386, 0.15597,
	0.30282, -0.58906, 0.68543, -0.38597, -0.06279, -0.54720, 0.25182, 0.82328,
	0.88645, 0.34853, -0.11485, 0.11643, -0.10594, -0.29699, 0.39242, -0.74788,
	0.48683, -0.84516, -0.57055, -0.29724, -0.82128, -0.31308, -0.69511, -0.89012,
	-0.89009, 0.07995, 0.13595, 0.05673, 0.37888, -0.30947, 0.79887, 0.67519,
	-0.42580, -0.11437, -0.32865, 0.13628, 0.68246, 0.93036, -0.56821, 0.95197,
	0.51925, -0.14100, -0.16252, -0.03623, -0.92996, -0.90618, -0.67707, -0.37573,
	0.66437, -0.07032, 0.05183, 0.34235, 0.90148, -0.04686, -0.01495, 0.64735,
	0.65105, -0.84336, -0.10085, -0.74739, -0.46474, -0.53494, 0.10875, -0.31396,
	0.69259, 0.73213, -0.81233, -0.64913, 0.54595, -0.38605, -0.68659, -0.79818,
	-0.33267, 0.64638, 0.13171, -0.73885, 0.16295, -0.58694, -0.23259, 0.19317,
	0.84655, -0.05892, 0.86475, -0.77505, -0.15645, -0.99129, -0.49150, -0.84293,
	0.94932, 0.29311, -0.59771, 0.68872, 0.31332, -0.23943, -0.49130, 0.37298,
	0.34821, -0.34977, 0.22512, -0.30873, -0.14706, 0.44717, -0.05308, -0.71369,
	0.31179, -0.75840, 0.25601, -0.99154, 0.75371, -0.18663, 0.48051, 0.45765,
	0.81772, -0.90423, -0.66372, 0.17796, -0.06589, 0.63307, -0.21543, -0.41733,
	-0.35413, 0.20887, -0.68940, -0.02008, -0.01316, 0.20710, 0.41619, -0.74711,
	0.21044, -0.86731, -0.40429, 0.31527, -0.50019, 0.20727, 0.42681, -0.51183,
	-0.34053, 0.85313, -0.59097, -0.52093, -0.10263, -0.38162, -0.01989, 0.65311,
	-0.44187, 0.89081, -0.00082, -0.06588, -0.66432, 0.53305, -0.52351, 0.46760,
	0.16069, 0.37733, -0.60415, 0.67689, -0.94166, -0.31491, -0.90083, -0.29665,
	0.12170, 0.32952, -0.33499, -0.70387, -0.52222, -0.97441, -0.59015, 0.51693,
	-0.62868, 0.71943, -0.28437, -0.02443, -0.05180, -0.13541, 0.34046, 0.80772,
	-0.54394, 0.55569, 0.86178, -0.37334, 0.63520, -0.67931, -0.92772, 0.04968,
	0.31762, 0.18766, -0.16258, 0.25706, 0.41979, 0.42128, -0.22912, -0.54600,
	-0.70691, 0.42877, 0.23496, -0.52562, -0.14171, -0.00629, 0.95376, -0.60945,
	-0.89670, 0.66244, -0.85348, 0.61177, 0.92771, -0.70460, 0.44423, -0.24610,
	0.93856, 0.06116, 0.17954, -0.52514, 1.00000, -0.64373, 0.54945, 0.18565,
	0.00168, 0.56514, -0.13475, 0.91781, -0.48687, -0.70561, 0.26777, -0.49407,
	0.55693, -0.88020, -0.78241, 0.48821, -0.77683, -0.68623, 0.90981, 0.53094,
	0.25752, 0.32396, -0.27437, 0.67197, 0.63754, -0.41175, 0.60498, -0.43014,
	0.38118, -0.11821, 0.71437, -0.46019, 0.53603, -0.78460, -0.74496, -0.35695,
	0.35338, 0.95040, 0.47276, 0.35874, 0.11656, 0.87794, -0.06115, 0.35405,
	0.90141, 0.16869, -0.73754, -0.64915, -0.02265, -0.94984, -0.32963, 0.19429,
	-0.93062, -0.65320, 0.92243, 0.54011, -0.51904, -0.01093, 0.92975, 0.20349,
	-0.78123, -0.66652, 0.57926, -0.60852, -0.44760, 0.73288, 0.75741, -0.75232,
	-0.83114, -0.35694, 0.87853, -0.76382, 0.95849, 0.71558, -0.81547, 0.11326,
	-0.99287, -0.80734, -0.87611, -0.16914, -0.04413, 0.71525, 0.00503, 0.49270,
	0.41567, -0.31774, -0.45336, 0.52720, 0.97144, -0.72240, -0.96874, -0.94277,
	0.30919, 0.89427, -0.24553, 0.53234, -0.91251, -0.73786, 0.82401, 0.40582,
	-0.75172, 0.84648, 0.63860, -0.49905, 0.51899, 0.45737, 0.79344, 0.31110,
	0.62876, 0.39919, 0.79039, 0.49035, -0.57875, -0.32039, -0.96356, -0.26258,
	-0.61409, -0.00483, -0.86857, -0.68476, -0.29619, -0.56329, 0.43378, 0.78456,
	-0.01694, -0.01183, -0.09896, -0.55123, 0.79278, 0.18921, 0.97148, 0.25318,
	-0.11770, 0.39879, 0.48104, 0.84337, -0.82543, 0.91847, -0.66895, -0.25090,
	-0.65096, 0.22016, 0.67252, -0.68382, 0.35917, -0.08427, -0.33794, -0.89396,
	-0.80006, 0.81813, 0.28726, -0.66559, 0.25875, 0.78168, 0.06080, 0.65235,
	-0.34473, 0.64635, -0.67792, 0.17349, 0.19687, 0.61218, -0.46549, 0.99976,
	-0.13156, -0.81728, -0.05379, 0.86947, 0.19859, 0.86707, 0.27560, -0.32570,
	-0.72426, -0.12111, -0.65361, -0.67011, -0.24015, 0.78672, -0.08236, -0.61055,
	-0.27614, 0.47512, -0.22132, -0.62897, -0.33233, 0.78109, -0.26050, 0.69706,
	-0.91894, 0.20970, 0.75544, -0.02593, -0.13970, 0.95140, 0.10235, -0.70098,
	-0.24454, 0.05123, -0.02925, 0.37769, 0.45531, -0.50771, -0.78809, -0.39354,
	0.90506, -0.66457, 0.60534, -0.21530, -0.89481, 0.38934, -0.35288, -0.78285,
	-0.87893, -0.12990, 0.32702, 0.07486, 0.47132, -0.77563, 0.45899, -0.62194,
	-0.91128, -0.15085, -0.37004, -0.98235, -0.29292, -0.21652, 0.43019, 0.46361,
	0.53704, 0.19494, -0.89654, 0.44798, -0.04400, 0.51189, 0.53671, 0.19266,
	0.63373, -0.67881, 0.95825, 0.09687, 0.10715, -0.68250, -0.75074, 0.99703,
	0.61993, 0.03215, -0.07181, 0.42967, 0.65172, -0.82433, -0.30345, -0.05949,
	0.59219, -0.95470, -0.54785, 0.44483, 0.58361, 0.45418, 0.71463, 0.60805,
	0.31174, -0.77111, 0.63900, -0.03076, 0.62422, 0.68735, 0.49031, 0.09163,
	0.17225, -0.16325, 0.16542, -0.09268, -0.87434, -0.16436, 0.05472, -0.80085,
	0.09766, 0.75408, -0.57229, -0.16380, -0.27542, -0.60834, -0.43836, -0.40834,
	0.64850, -0.90495, -0.92462, -0.88828, 0.44491, -0.18078, 0.64070, -0.79378,
	0.66074, 0.13215, -0.24123, -0.24627, 0.39350, 0.62649, 0.99507, 0.23926,
	-0.21245, 0.14189, -0.69340, 0.53962, 0.63052, -0.03605, 0.98831, 0.75873,
	0.84765, 0.88673, 0.65383, -0.53132, -0.45356, -0.64695, 0.81389, -0.87123,
	0.11427, 0.38016, -0.46442, -0.74516, -0.73924, 0.54859, 0.80383, -0.10292,
	0.69810, -0.29392, -0.82633, -0.25984, -0.24541, -0.99538, 0.56860, -0.94362,
	-0.20703, 0.28567, -0.21582, 0.68896, -0.88585, -0.78190, -0.67149, -0.04862,
	-0.72620, 0.92330, -0.09746, 0.36470, 0.11482, -0.56599, 0.36970, 0.32746,
	-0.56299, 0.14644, -0.90604, 0.51632, 0.02962, -0.09110, -0.87456, 0.79992,
	0.59801, 0.10297, -0.28423, -0.12416, 0.94970, 0.98561, -0.91582, 0.71989,
	0.17109, -0.35022, -0.62771, -0.16208, 0.15643, 0.90448, 0.45347, -0.64469,
	-0.86664, 0.53715, -0.85646, -0.63035, -0.54336, 0.01417, 0.64264, -0.03554,
	-0.28106, 0.59136, -0.50166, -0.41335, 0.23432, 0.18747, -0.79195, 0.09573,
	-0.53433, -0.92600, -0.19608, 0.29496, -0.22216, -0.72213, -0.83901, -0.38108,
	0.12243, 0.92301, 0.07193, -0.93649, -0.52233, 0.86743, -0.24203, -0.38463,
	0.32346, -0.09490, 0.87048, -0.35914, 0.82356, 0.64510, 0.11949, -0.87585,
	-0.04079, -0.66324, -0.52676, 0.76925, -0.78665, -0.51786, 0.07466, 0.62202,
	-0.24782, -0.84510, 0.31780, -0.80804, -0.47458, -0.61206, 0.70021, -0.17280,
	-0.57922, -0.25504, 0.47037, -0.35760, -0.38982, 0.55828, -0.69283, -0.23262,
	-0.05606, 0.16837, -0.43062, 0.55261, 0.17218, 0.94475, -0.49970, -0.57848,
	0.46778, -0.18541, -0.17367, -0.95894, 0.66776, -0.66261, 0.75960, 0.41824,
	0.87942, -0.69230, 0.81038, 0.14322, 0.54833, 0.49719, -0.06630, -0.31245,
	-0.44272, -0.36487, 0.06490, -0.15388, 0.36372, 0.37990, -0.40211, 0.59612,
	0.50497, 0.04736, -0.23384, 0.18868, -0.46568, -0.54597, -0.21177, -0.20992,
	-0.02354, 0.62033, 0.40063, 0.71015, -0.12639, 0.82678, 0.60487, -0.26514,
	0.64116, -0.59881, -0.65247, -0.50655, -0.30345, 0.03152, -0.61937, 0.36096,
	-0.85524, 0.24343, -0.34744, 0.74436, -0.01967, -0.14027, 0.65464, 0.16066,
	0.51878, -0.25926, -0.04518, 0.63727, -0.68258, -0.67111, -0.46873, 0.28534,
	0.30313, -0.54305, -0.28460, 0.04525, 0.88169, -0.14929, 0.88127, -0.18422,
	0.53426, 0.40850, -0.17177, 0.48297, 0.08491, 0.63499, 0.70043, 0.10247,
	0.19939, -0.56572, -0.09003, 0.43052, -0.43855, 0.97468, -0.16784, -0.42868,
	0.64104, 0.63049, 0.19642, -0.49872, -0.15372, -0.30233, -0.63834, -0.56476,
	-0.74453, 0.94820, 0.03851, 0.76473, -0.23131, -0.63189, -0.91989, 0.26873,
	-0.08216, -0.74404, 0.80357, -0.26335, -0.21307, -0.64377, 0.16065, 0.02028,
	0.00064, -0.14840, -0.57420, 0.55963, 0.24339, -0.48948, -0.03748, -0.88604,
	0.55484, 0.80878, 0.52396, -0.90009, -0.12397, -0.26477, 0.72882, 0.12302,
	-0.68727, 0.20584, -0.33819, 0.58508, 0.74564, 0.89181, 0.04617, 0.55391,
	0.86220, 0.99437, 0.43789, 0.01319, -0.93531, 0.21065, 0.55217, 0.65701,
	0.94116, 0.80026, -0.99790, -0.00375, -0.47328, 0.55730, -0.24385, -0.09960,
	0.15613, 0.17638, 0.17688, -0.88790, -0.75610, -0.91231, -0.12260, 0.07359,
	-0.46870, -0.73617, 0.35899, 0.06054, 0.57893, -0.18158, -0.90988, -0.28471,
	-0.43429, 0.46532, -0.50567, 0.88209, 0.84061, -0.93065, -0.61386, -0.14349,
	-0.50210, -0.38984, 0.82611, 0.14785, 0.66913, -0.54771, -0.46653, -0.32097,
	0.40154, 0.59889, -0.86372, 0.94286, 0.82204, -0.22041, -0.29600, 0.28652,
	0.46650, -0.04090, -0.13771, -0.60066, 0.10422, 0.12990, 0.32678, -0.46331,
	0.84788, 0.88883, -0.23272, -0.19148, -0.11034, 0.50806, 0.86289, 0.74069,
	-0.31144, -0.73369, 0.02575, -0.91544, -0.23648, 0.14056, 0.38908, 0.60642,
	-0.01767, 0.82331, -0.89543, 0.85069, -0.27862, -0.31923, 0.94164, 0.66147,
	0.21340, 0.24585, -0.77242, -0.09319, -0.06169, 0.49136, 0.25640, -0.77656,
	-0.83065, -0.34116, -0.05430, 0.70032, 0.61237, -0.35026, -0.34675, 0.93844,
	0.31642, -0.95051, -0.63530, 0.90552, 0.04459, 0.95675, -0.01225, 0.59298,
	-0.25676, 0.89801, -0.70855, 0.28203, 0.37807, 0.24243, 0.54525, 0.36737,
	-0.76555, 0.83315, 0.80874, -0.77173, -0.62861, 0.23470, 0.31025, 0.16967,
	0.06496, -0.83233, 0.42227, 0.38177, 0.72656, 0.91644, -0.26663, -0.36656,
	0.72331, -0.32207, 0.43375, 0.20429, -0.99675, -0.04635, -0.70913, -0.58283,
	0.63894, -0.54594, -0.83365, -0.21322, -0.43462, 0.52013, 0.09397, -0.71954,
	-0.93791, 0.15199, 0.64187, 0.13407, 0.08088, 0.58111, 0.67728, 0.65659,
	-0.15526, -0.32960, 0.17825, -0.21861, 0.05791, 0.36717, 0.07829, -0.77127,
	-0.82370, -0.48219, -0.37827, -0.40147, 0.64789, -0.46412, 0.75603, -0.93205,
	0.20645, -0.29086, 0.85086, -0.90490, -0.42901, -0.95545, -0.51794, 0.47028,
	0.17021, 0.46958, -0.40179, 0.25511, -0.43128, -0.81826, 0.70627, 0.94044,
	-0.86086, 0.01452, -0.52078, -0.03052, -0.35332, -0.36437, 0.24889, -0.28547,
	-0.67078, -0.78260, 0.86642, 0.85056, 0.29424, -0.65641, 0.39102, -0.34772,
	-0.10636, -0.91766, 0.74055, -0.29530, 0.30446, 0.52387, 0.90911, -0.53816,
	-0.21380, -0.37109, 0.66129, -0.11576, 0.43171, -0.96287, -0.75041, -0.24886,
	-0.66633, 0.69821, -0.93857, -0.92365, 0.50723, -0.02512, -0.13714, 0.05363,
	0.14010, 0.70922, 0.66594, 0.08475, 0.67090, 0.98152, -0.87734, 0.17001,
	0.09369, 0.98490, -0.65961, -0.73373, 0.54971, 0.65263, 0.62907, -0.25714,
	0.66858, 0.59739, 0.82273, 0.82965, -0.76471, 0.78711, -0.73570, 0.27698,
	0.00750, 0.85776, -0.32007, 0.46217, -0.94338, 0.58766, 0.84843, 0.24479,
	-0.78683, 0.95303, 0.17718, -0.48229, -0.14995, -0.30178, 0.96008, 0.54672,
};

struct voxworld_generation_state {

	b32 Initialized;

	/*
		NOTE(dima): Work threadworks are used to 
		store loaded chunks data.
	*/
	int FreeChunkThreadworksCount;
	int TotalChunkThreadworksCount;

	int ChunkTasksMemUsed;
	platform_mutex ChunksThreadworksMutex;
	voxworld_threadwork* ChunkUseSentinel;
	voxworld_threadwork* ChunkFreeSentinel;

	/*
		NOTE(dima): Gen threadworks are used to 
		store temp information while generating chunks or meshes;
	*/
	int FreeGenThreadworksCount;
	int TotalGenThreadworksCount;

	int GenTasksMemUsed;
	platform_mutex GenMutex;
	voxworld_threadwork* GenUseSentinel;
	voxworld_threadwork* GenFreeSentinel;

	/*
		NOTE(dima): Mesh threadworks are used to
		store max possible memory for allocating 
		the mesh.
	*/
	int FreeMeshThreadworks;
	int TotalMeshThreadworks;

	int MeshTasksMemUsed;
	platform_mutex MeshMutex;
	voxworld_threadwork* MeshUseSentinel;
	voxworld_threadwork* MeshFreeSentinel;

	int ChunksSideCount;
	int ChunksCount;
	int ChunksViewDistance;

	int ChunksPushedToRender;
	int TrianglesLoaded;
	int TrianglesPushed;

	platform_atomic_type_i32 MeshGenerationsStartedThisFrame;
	
	stacked_memory* TotalMemory;

	platform_mutex MemoryAllocatorMutex;

	platform_mutex HashTableOpMutex;
	int HashTableMemUsed;
#define VOXWORLD_TABLE_SIZE 65536
	voxworld_table_entry* HashTable[VOXWORLD_TABLE_SIZE];
	int HashTableCollisionCount;
	int HashTableTotalInsertedEntries;

	voxworld_table_entry* FreeTableEntrySentinel;
	voxworld_table_entry* WorkTableEntrySentinel;

	//voxel_atlas_info* VoxelAtlas;

	volatile u32 SmoothRandomIndex;

	voxel_generation_statistics DEBUGStat;
};

void VoxelChunksGenerationUpdate(
	stacked_memory* Memory,
	render_state* RenderState,
	int VoxelThreadQueueSize,
	v3 CameraPos);

#endif